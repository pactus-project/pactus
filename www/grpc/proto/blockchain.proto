syntax = 'proto3';
package pactus;

option go_package = "github.com/pactus-project/pactus/www/grpc/pactus";
option java_package = "pactus.blockchain";

import "transaction.proto";

service Blockchain {
  rpc GetBlock(GetBlockRequest) returns (GetBlockResponse);
  rpc GetBlockHash(GetBlockHashRequest) returns (GetBlockHashResponse);
  rpc GetBlockHeight(GetBlockHeightRequest) returns (GetBlockHeightResponse);
  rpc GetBlockchainInfo(GetBlockchainInfoRequest) returns (GetBlockchainInfoResponse);
  rpc GetConsensusInfo(GetConsensusInfoRequest) returns (GetConsensusInfoResponse);
  rpc GetAccount(GetAccountRequest) returns (GetAccountResponse);
  rpc GetValidator(GetValidatorRequest) returns (GetValidatorResponse);
  rpc GetValidatorByNumber(GetValidatorByNumberRequest) returns (GetValidatorResponse);
  rpc GetValidators(GetValidatorsRequest) returns (GetValidatorsResponse);
}

message GetAccountRequest { string address = 1; }

message GetAccountResponse { AccountInfo account = 1; }

message GetValidatorsRequest {}

message GetValidatorRequest { string address = 1; }

message GetValidatorByNumberRequest { int32 number = 1; }

message GetValidatorsResponse { repeated ValidatorInfo validators = 1; }

message GetValidatorResponse { ValidatorInfo validator = 1; }

message GetBlockRequest {
  uint32 height = 1;
  BlockVerbosity verbosity = 2;
}

message GetBlockResponse {
  uint32 height = 1;
  bytes hash = 2;
  bytes data = 3;
  uint32 block_time = 4;
  BlockHeaderInfo header = 5;
  CertificateInfo prev_cert = 6;
  repeated TransactionInfo txs = 7;
}

message GetBlockHashRequest { uint32 height = 1; }

message GetBlockHashResponse { bytes hash = 1; }

message GetBlockHeightRequest { bytes hash = 1; }

message GetBlockHeightResponse { uint32 height = 1; }

message GetBlockchainInfoRequest {}

message GetBlockchainInfoResponse {
  uint32 last_block_height = 1;
  bytes last_block_hash = 2;
  int64 total_power = 3;
  int64 committee_power = 4;
  repeated ValidatorInfo committee_validators = 5;
}

message GetConsensusInfoRequest {}

message GetConsensusInfoResponse {
  uint32 height = 1;
  int32 round = 2;
  repeated VoteInfo votes = 3;
}

message ValidatorInfo {
  string public_key = 1;
  int32 number = 2;
  int32 sequence = 3;
  int64 stake = 4;
  uint32 last_bonding_height = 5;
  uint32 last_joined_height = 6;
  uint32 unbonding_height = 7;
  string address = 8;
}

message AccountInfo {
  string address = 1;
  int32 number = 2;
  int32 sequence = 3;
  int64 Balance = 4;
}

message BlockHeaderInfo {
  int32 version = 1;
  bytes prev_block_hash = 2;
  bytes state_root = 3;
  bytes sortition_seed = 4;
  string proposer_address = 5;
}

message CertificateInfo {
  int32 round = 1;
  repeated int32 committers = 2;
  repeated int32 absentees = 3;
  bytes signature = 4;
}

message VoteInfo {
  VoteType type = 1;
  string voter = 2;
  bytes block_hash = 3;
  int32 round = 4;
}

enum BlockVerbosity {
  BLOCK_DATA = 0;
  BLOCK_INFO = 1;
  BLOCK_TRANSACTIONS = 2;
}

enum VoteType {
  VOTE_PREPARE = 0;
  VOTE_PRECOMMIT = 1;
  VOTE_CHANGE_PROPOSER = 2;
}
