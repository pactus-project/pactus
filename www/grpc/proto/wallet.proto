syntax = "proto3";
package pactus;

import "transaction.proto";

option go_package = "github.com/pactus-project/pactus/www/grpc/pactus";
option java_package = "pactus";

// Wallet service provides RPC methods for wallet management operations.
service Wallet {
  // CreateWallet creates a new wallet with the specified parameters.
  rpc CreateWallet(CreateWalletRequest) returns (CreateWalletResponse);

  // RestoreWallet restores an existing wallet with the given mnemonic.
  rpc RestoreWallet(RestoreWalletRequest) returns (RestoreWalletResponse);

  // LoadWallet loads an existing wallet with the given name.
  rpc LoadWallet(LoadWalletRequest) returns (LoadWalletResponse);

  // UnloadWallet unloads a currently loaded wallet with the specified name.
  rpc UnloadWallet(UnloadWalletRequest) returns (UnloadWalletResponse);

  // GetTotalBalance returns the total available balance of the wallet.
  rpc GetTotalBalance(GetTotalBalanceRequest) returns (GetTotalBalanceResponse);

  // SignRawTransaction signs a raw transaction for a specified wallet.
  rpc SignRawTransaction(SignRawTransactionRequest) returns (SignRawTransactionResponse);

  // GetValidatorAddress retrieves the validator address associated with a public key.
  // Deprecated: Will move into utils.
  rpc GetValidatorAddress(GetValidatorAddressRequest) returns (GetValidatorAddressResponse);

  // GetNewAddress generates a new address for the specified wallet.
  rpc GetNewAddress(GetNewAddressRequest) returns (GetNewAddressResponse);

  // SignMessage signs an arbitrary message using a wallet's private key.
  rpc SignMessage(SignMessageRequest) returns (SignMessageResponse);

  // GetTotalStake returns the total stake amount in the wallet.
  rpc GetTotalStake(GetTotalStakeRequest) returns (GetTotalStakeResponse);

  // GetAddressInfo returns detailed information about a specific address.
  rpc GetAddressInfo(GetAddressInfoRequest) returns (GetAddressInfoResponse);

  // SetAddressLabel sets or updates the label for a given address.
  rpc SetAddressLabel(SetAddressLabelRequest) returns (SetAddressLabelResponse);

  // ListWallets returns a list of all available wallets.
  // If `include_unloaded` is set, it returns both loaded and unloaded wallets.
  rpc ListWallets(ListWalletsRequest) returns (ListWalletsResponse);

  // GetWalletInfo returns detailed information about a specific wallet.
  rpc GetWalletInfo(GetWalletInfoRequest) returns (GetWalletInfoResponse);

  // IsWalletLoaded checks whether the specified wallet is currently loaded.
  rpc IsWalletLoaded(IsWalletLoadedRequest) returns (IsWalletLoadedResponse);

  // ListAddresses returns all addresses in the specified wallet.
  rpc ListAddresses(ListAddressesRequest) returns (ListAddressesResponse);

  // UpdatePassword updates the password of an existing wallet.
  rpc UpdatePassword(UpdatePasswordRequest) returns (UpdatePasswordResponse);

  // ListTransactions returns a list of transactions for a wallet,
  // optionally filtered by a specific address, with pagination support.
  rpc ListTransactions(ListTransactionsRequest) returns (ListTransactionsResponse);
}

// AddressType defines different types of blockchain addresses.
enum AddressType {
  // Treasury address type.
  // Should not be used to generate new addresses.
  ADDRESS_TYPE_TREASURY = 0;
  // Validator address type used for validator nodes.
  ADDRESS_TYPE_VALIDATOR = 1;
  // Account address type with BLS signature scheme.
  ADDRESS_TYPE_BLS_ACCOUNT = 2;
  // Account address type with Ed25519 signature scheme.
  // Note: Generating a new Ed25519 address requires the wallet password.
  ADDRESS_TYPE_ED25519_ACCOUNT = 3;
}

// AddressInfo contains detailed information about a wallet address.
message AddressInfo {
  // The address string.
  string address = 1;
  // The public key associated with the address.
  string public_key = 2;
  // A human-readable label associated with the address.
  string label = 3;
  // The Hierarchical Deterministic (HD) path of the address within the wallet.
  string path = 4;
}

// Request message for generating a new wallet address.
message GetNewAddressRequest {
  // The name of the wallet to generate a new address.
  string wallet_name = 1;
  // The type of address to generate.
  AddressType address_type = 2;
  // A label for the new address.
  string label = 3;
  // Password for the new address. It's required when address_type is Ed25519 type.
  string password = 4;
}

// Response message contains newly generated address information.
message GetNewAddressResponse {
  // The name of the wallet where address was generated.
  string wallet_name = 1;
  // Detailed information about the new address.
  AddressInfo address_info = 2;
}

// Request message for restoring a wallet from mnemonic (seed phrase).
message RestoreWalletRequest {
  // The name for the restored wallet.
  string wallet_name = 1;
  // The mnemonic (seed phrase) for wallet recovery.
  string mnemonic = 2;
  // Password to secure the restored wallet.
  string password = 3;
}

// Response message confirming wallet restoration.
message RestoreWalletResponse {
  // The name of the restored wallet.
  string wallet_name = 1;
}

// Request message for creating a new wallet.
message CreateWalletRequest {
  // The name for the new wallet.
  string wallet_name = 1;
  // Password to secure the new wallet.
  string password = 2;
}

// Response message contains wallet recovery mnemonic (seed phrase).
message CreateWalletResponse {
  // The name for the new wallet.
  string wallet_name = 1;
  // The mnemonic (seed phrase) for wallet recovery.
  string mnemonic = 2;
}

// Request message for loading an existing wallet.
message LoadWalletRequest {
  // The name of the wallet to load.
  string wallet_name = 1;
}

// Response message confirming wallet loaded.
message LoadWalletResponse {
  // The name of the loaded wallet.
  string wallet_name = 1;
}

// Request message for unloading a wallet.
message UnloadWalletRequest {
  // The name of the wallet to unload.
  string wallet_name = 1;
}

// Response message confirming wallet unloading.
message UnloadWalletResponse {
  // The name of the unloaded wallet.
  string wallet_name = 1;
}

// Request message for obtaining the validator address associated with a public key.
message GetValidatorAddressRequest {
  // The public key of the validator.
  string public_key = 1;
}

// Response message containing the validator address corresponding to a public key.
message GetValidatorAddressResponse {
  // The validator address associated with the public key.
  string address = 1;
}

// Request message for signing a raw transaction.
message SignRawTransactionRequest {
  // The name of the wallet used for signing.
  string wallet_name = 1;
  // The raw transaction data to be signed.
  string raw_transaction = 2;
  // Wallet password required for signing.
  string password = 3;
}

// Response message contains the transaction ID and signed raw transaction.
message SignRawTransactionResponse {
  // The ID of the signed transaction.
  string transaction_id = 1;
  // The signed raw transaction data.
  string signed_raw_transaction = 2;
}

// Request message for obtaining the total available balance of a wallet.
message GetTotalBalanceRequest {
  // The name of the wallet to get the total balance.
  string wallet_name = 1;
}

// Response message contains the total available balance of the wallet.
message GetTotalBalanceResponse {
  // The name of the queried wallet.
  string wallet_name = 1;
  // The total balance of the wallet in NanoPAC.
  int64 total_balance = 2;
}

// Request message to sign an arbitrary message.
message SignMessageRequest {
  // The name of the wallet to sign with.
  string wallet_name = 1;
  // Wallet password required for signing.
  string password = 2;
  // The address whose private key should be used for signing the message.
  string address = 3;
  // The arbitrary message to be signed.
  string message = 4;
}

// Response message contains message signature.
message SignMessageResponse {
  // The signature in hexadecimal format.
  string signature = 1;
}

// Request message for obtaining the total stake of a wallet.
message GetTotalStakeRequest {
  // The name of the wallet to get the total stake.
  string wallet_name = 1;
}

// Response message contains the total stake of the wallet.
message GetTotalStakeResponse {
  // The name of the queried wallet.
  string wallet_name = 1;
  // The total stake amount in NanoPAC.
  int64 total_stake = 2;
}

// Request message for getting address information.
message GetAddressInfoRequest {
  // The name of the wallet containing the address.
  string wallet_name = 1;
  // The address to query.
  string address = 2;
}

// Response message contains address details.
message GetAddressInfoResponse {
  // The name of the wallet containing the address.
  string wallet_name = 1;
  // Detailed information about the address.
  AddressInfo address_info = 2;
}

// Request message for setting address label.
message SetAddressLabelRequest {
  // The name of the wallet containing the address.
  string wallet_name = 1;
  // Wallet password required for modification.
  string password = 2;
  // The address to label.
  string address = 3;
  // The new label for the address.
  string label = 4;
}

// Response message for updated address label.
message SetAddressLabelResponse {
  // The name of the wallet where the address label was updated.
  string wallet_name = 1;
  // The address where the label was updated.
  string address = 2;
  // The new label for the address.
  string label = 3;
}

// Request message for listing wallets.
message ListWalletsRequest {
  // Whether to include wallets that exist on disk but are not currently loaded.
  bool include_unloaded = 1;
}

// Response message contains wallet names.
message ListWalletsResponse {
  // Array of wallet names.
  repeated string wallets = 1;
}

// Request message for checking wallet load status.
message IsWalletLoadedRequest {
  // Name of the wallet to check.
  string wallet_name = 1;
}

// Response message indicating wallet load status.
message IsWalletLoadedResponse {
  // Name of the wallet.
  string wallet_name = 1;

  // True if the wallet is currently loaded.
  bool loaded = 2;
}

// Request message for getting wallet information.
message GetWalletInfoRequest {
  // The name of the wallet to query.
  string wallet_name = 1;
}

// Response message contains wallet details.
message GetWalletInfoResponse {
  // The name of the wallet.
  string wallet_name = 1;

  // The wallet format version.
  int32 version = 2;

  // The network the wallet is connected to (e.g., mainnet, testnet).
  string network = 3;

  // Indicates if the wallet is encrypted.
  bool encrypted = 4;

  // A unique identifier of the wallet.
  string uuid = 5;

  // Unix timestamp of wallet creation.
  int64 created_at = 6;

  // The default fee of the wallet.
  int64 default_fee = 7;

  // The storage driver used by the wallet (e.g., SQLite, Legacy JSON ).
  string driver = 8;

  // Path to the wallet file or storage location.
  string path = 9;
}

// Request message for listing wallet addresses.
message ListAddressesRequest {
  // The name of the queried wallet.
  string wallet_name = 1;

  // Filter addresses by their types. If empty, all address types are included.
  repeated AddressType address_types = 2;
}

// Response message contains wallet addresses.
message ListAddressesResponse {
  // The name of the queried wallet.
  string wallet_name = 1;

  // List of all addresses in the wallet with their details.
  repeated AddressInfo data = 2;
}

// Request message for updating wallet password.
message UpdatePasswordRequest {
  // The name of the wallet whose password will be updated.
  string wallet_name = 1;
  // The current wallet password.
  string old_password = 2;
  // The new wallet password.
  string new_password = 3;
}

// Response message confirming wallet password update.
message UpdatePasswordResponse {
  // The name of the wallet whose password was updated.
  string wallet_name = 1;
}

// TxDirection indicates the direction of a transaction relative to the wallet.
enum TxDirection {
  // Include only transactions where the wallet receives funds.
  TX_DIRECTION_INCOMING = 0;

  // Include only transactions where the wallet sends funds.
  TX_DIRECTION_OUTGOING = 1;
}

// Request message for listing transactions of a wallet, optionally filtered by a specific address.
message ListTransactionsRequest {
  // The name of the wallet to query transactions for.
  string wallet_name = 1;

  // Filter transactions by direction relative to the wallet.
  // Defaults to incoming if not set.
  TxDirection direction = 2;

  // Optional: The address to filter transactions.
  // If empty or set to "*", transactions for all addresses in the wallet are included.
  string address = 3;

  // Optional: The maximum number of transactions to return.
  // Defaults to 10 if not set.
  int32 count = 4;

  // Optional: The number of transactions to skip (for pagination).
  // Defaults to 0 if not set.
  int32 skip = 5;
}

// Response message containing a list of transactions.
message ListTransactionsResponse {
  // The name of the wallet queried.
  string wallet_name = 1;

  // List of transactions for the wallet, filtered by the specified address if provided.
  repeated TransactionInfo txs = 2;
}
